const allAchievements = {
  r11 : "You gotta start somewhere",
  r12 : "100 antimatter is a lot",
  r13 : "Half life 3 confirmed",
  r14 : "L4D: Left 4 Dimensions",
  r15 : "5 Dimension Antimatter Punch",
  r16 : "We couldn't afford 9",
  r17 : "Not a luck related achievement",
  r18 : "90 degrees to infinity",
  r21 : "To infinity!",
  r22 : "Fake News",
  r23 : "The 9th Dimension is a lie",
  r24 : "Antimatter Apocalypse",
  r25 : "Boosting to the max",
  r26 : "You got past The Big Wall",
  r27 : "Double Galaxy",
  r28 : "There's no point in doing that",
  r31 : "I forgot to nerf that",
  r32 : "The Gods are pleased",
  r33 : "That's a lot of infinites",
  r34 : "You didn't need it anyway",
  r35 : "Don't you dare to sleep",
  r36 : "Claustrophobic",
  r37 : "That's fast!",
  r38 : "I don't believe in Gods",
  r41 : "Spreading Cancer",
  r42 : "Supersanic",
  r43 : "Zero Deaths",
  r44 : "Over in 30 seconds",
  r45 : "Faster than a potato",
  r46 : "Multidimensional",
  r47 : "Daredevil",
  r48 : "AntiChallenged",
  r51 : "Limit Break",
  r52 : "Age of Automation",
  r53 : "Definitely not worth it",
  r54 : "That's faster!",
  r55 : "Forever isn't that long",
  r56 : "Many Deaths",
  r57 : "Gift from the Gods",
  r58 : "Is this hell?",
  r61 : "Bulked up",
  r62 : "Oh hey, you're still here",
  r63 : "A new beginning.",
  r64 : "1 million is a lot",
  r65 : "Not-so-challenging",
  r66 : "Faster than a squared potato",
  r67 : "Infinitely Challenging",
  r68 : "You did this again just for the achievement right?",
  r71 : "ERROR 909: Dimension not found",
  r72 : "Can't hold all these infinities",
  r73 : "This achievement doesn't exist",
  r74 : "End me",
  r75 : "NEW DIMENSIONS???",
  r76 : "One for each dimension",
  r77 : "How the antitables have turned",
  r78 : "Blink of an eye",
  r81 : "Hevipelle did nothing wrong",
  r82 : "Anti-antichallenged",
  r83 : "YOU CAN GET 50 GALAXIES!??",
  r84 : "I got a few to spare",
  r85 : "All your IP are belong to us",
  r86 : "Do you even bend time bro?",
  r87 : "2 Million Infinities",
  r88 : "Yet another infinity reference",
  r91 : "Ludicrous Speed",
  r92 : "I brake for nobody",
  r93 : "MAXIMUM OVERDRIVE",
  r94 : "Minute of infinity",
  r95 : "Is this safe?",
  r96 : "Time is relative",
  r97 : "Yes. This is hell.",
  r98 : "0 degrees from infinity",
  r101 : "Costco sells dimboosts now",
  r102 : "This mile took an Eternity",
  r103 : "This achievement doesn't exist II",
  r104 : "That wasn't an eternity",
  r105 : "Infinite time",
  r106 : "The swarm",
  r107 : "Do you really need a guide for this?",
  r108 : "We could afford 9",
  r111 : "Yo dawg, I heard you liked infinities...",
  r112 : "Never again",
  r113 : "Long lasting relationship",
  r114 : "You're a mistake",
  r115 : "I wish I had gotten 7 eternities",
  r116 : "Do I really need to infinity",
  r117 : "8 nobody got time for that",
  r118 : "IT'S OVER 9000",
  r121 : "Can you get infinite IP?",
  r122 : "You're already dead.",
  r123 : "5 more eternities until the update",
  r124 : "Eternities are the new infinity",
  r125 : "Like feasting on a behind",
  r126 : "Popular music",
  r127 : "But I wanted another prestige layer...",
  r128 : "What do I have to do to get rid of you",
  r131 : "No ethical consumption",
  r132 : "Unique snowflakes",
  r133 : "I never liked this infinity stuff anyway",
  r134 : "When will it be enough?",
  r135 : "Faster than a potato^286078",
  r136 : "I told you already, time is relative",
  r137 : "Now you're thinking with dilation!",
  r138 : "This is what I have to do to get rid of you.",
  ngud11 : "A newer beginning.",
  ngud12 : "1 million is still a lot",
  ngud13 : "Time is absolute",
  ngud14 : "Finally I'm out of that channel",
  ngud16 : "We couldn't afford 5",
  ngud18 : "I already got rid of you.",
  ngpp11 : "I'm so meta",
  ngpp12 : "And still no ninth dimension...",
  ngpp13 : "In the grim darkness of the far endgame",
  ngpp14 : "Meta-boosting to the max",
  ngpp15 : "The cap is a million, not a trillion",
  ngpp16 : "It will never be enough",
  ngpp17 : "GAS GAS GAS",
  ngpp18 : "Universal harmony",
  ng3p11 : "I don't have enough fuel!",
  ng3p12 : "Sub-atomic",
  ng3p13 : "Hadronization",
  ng3p14 : "Work harder.",
  ng3p15 : "No more tax fraud!",
  ng3p16 : "And the winner is...",
  ng3p17 : "Old age",
  ng3p18 : "I already got rid of you...",
  ng3p21 : "Special Relativity",
  ng3p22 : "We are not going squared.",
  ng3p23 : "This achievement doesn't exist 3",
  ng3p24 : "Old memories come true",
  ng3p25 : "Twice in a row",
  ng3p26 : "Infinity Morals",
  ng3p27 : "Intergalactic",
  ng3p28 : "Seriously, I already got rid of you.",
  ng3p31 : "ERROR 500: INTERNAL DIMENSION ERROR",
  ng3p32 : "The truth of anti-challenged",
  ng3p33 : "Never make paradoxes!",
  ng3p34 : "The Challenging Day",
  ng3p35 : "An ant office?",
  ng3p36 : "I canâ€™t get my multipliers higher!",
  ng3p37 : "No dilation means no production.",
  ng3p38 : "I don't want you to live anymore.",
  ng3p41 : "Time is not relative",
  ng3p42 : "ERROR 404: DIMENSIONS NOT FOUND",
  ng3p43 : "Impossible expectations",
  ng3p44 : "Studies are wasted",
  ng3p45 : "Do protons decay?",
  ng3p46 : "Hardly marked",
  ng3p47 : "Stop blocking me!",
  ng3p48 : "Are you currently dying?",
  ng3p51 : "To the new dimension!",
  ng3p52 : "Quantum doesn't take so long",
  ng3p53 : "Gonna go fast",
  ng3p54 : "We can really afford 9.",
  ng3p55 : "Time Breaker",
  ng3p56 : "Time Immunity",
  ng3p57 : "You're not really smart.",
  ng3p58 : "And so your life?",
  ng3p61 : "Kee-hee-hee!",
  ng3p62 : "Finite Time",
  ng3p63 : "This achievement doesn't exist 4",
  ng3p64 : "Really?",
  ng3p65 : "But I don't want to grind!",
  ng3p66 : "I rather oppose the theory of everything",
  ng3p67 : "Will it be enough?",
  ng3p68 : "Please answer me why you are dying.",
  ng3p71 : "Progressing as a Ghost",
  ng3p72 : "Underchallenged",
  ng3p73 : "Meta-Infinity confirmed?",
  ng3p74 : "Weak Decay",
  ng3p75 : "Radioactive Decaying to the max!",
  ng3p76 : "Running through Big Rips",
  ng3p77 : "The Theory of Ultimate Studies",
  ng3p78 : "Aren't you already dead?",
  ng3p81 : "Even Ghostlier than before",
  ng3p82 : "Overchallenged",
  ng3p83 : "Pulling an All-Nighter",
  ng3p84 : "Big Rip isn't enough",
  ng3p85 : "Everlasting Eternities",
  ng3p86 : "Back to Challenge One",
  ng3p87 : "The Deep Challenge",
  ng3p88 : "I give up.",
  s11 : "The first one's always free",
  s12 : "Just in case",
  s13 : "It pays to have respect",
  s14 : "So do I",
  s15 : "Do a barrel roll!",
  s16 : "Do you enjoy pain?",
  s17 : "30 Lives",
  s18 : "Do you feel lucky? Well do ya punk?",
  s21 : "Go study in real life instead",
  s22 : "Cancer = Spread",
  s23 : "Stop right there criminal scum!",
  s24 : "Real news",
  s25 : "Shhh... It's a secret",
  s26 : "You're a failure",
  s27 : "It's not called matter dimensions is it?",
  s28 : "Nice.",
  s31 : "You should download some more RAM",
  s32 : "Less than or equal to 0.001",
  s33 : "A sound financial decision",
  s34 : "You do know how these work, right?",
  s35 : "Should we tell them about buy max...",
  s36 : "While you were away... Nothing happened.",
  s37 : "You followed the instructions",
  s38 : "Professional bodybuilder",
  ng3ps11 : "Blanked out",
  ng3ps12 : "Lie the news",
  ng3ps13 : "Two tickers",
  ng3ps14 : "News for other species",
  ng3ps15 : "Boo!",
  ng3ps16 : "Up and Down and Up and Down...",
  ng3ps17 : "Did you not understand the automation?",
  ng3ps18 : "The Ultimate Challenge"
};
const secretAchievementTooltips = {
	s11 : "Click on this achievement.",
	s12 : "Save 100 times without refreshing.",
	s13 : "Pay respects.",
	s14 : "Say something naughty.",
	s15 : "Do a barrel roll.",
	s16 : "Use standard, cancer, or bracket notation for 10 minutes with more than 1 eternity without refreshing.",
	s17 : "Input the konami code.",
	s18 : "You have a 1/100,000 chance of getting this achievement every second.",
	s21 : "Purchase the secret time study.",
	s22 : "Buy one million Galaxies in total while using cancer notation.",
	s23 : "Open the console.",
	s24 : "Click on the news ticker that tells you to click on it.",
	s25 : "Discover a secret theme.",
	s26 : "Fail eternity challenges 10 times without refreshing. What are you doing with your life...",
	s27 : "Get Infinite matter.",
	s28 : "Don't act like you don't know what you did.",
	s31 : "Set your update rate to 200ms.",
	s32 : "Get a fastest infinity or eternity time of less than or equal to 0.001 seconds.",
	s33 : "Click on the donate link.",
	s34 : "Respec with an empty study tree.",
	s35 : "Buy single tickspeed 1,000,000 times.",
	s36 : "Have nothing happen while you were away.",
	s37 : "Follow instructions.",
	s38 : "Get all your dimension bulk buyers to 1e100.",
	ng3ps11 : "Click on the news ticker that doesn't show anything.",
	ng3ps12 : "Click on the news ticker that you shouldn't do.",
	ng3ps13 : "Make 2 news tickers shown.",
	ng3ps14 : "Unlock or show ghostly news ticker.",
	ng3ps15 : "You have a 1/1,000 chance of getting this achievement every time 'You became a ghost!' animation appears.",
	ng3ps16 : 'Press the "Continue to mastery studies." button and the "Lead back to time studies." button 100 times each.',
	ng3ps17 : "Manually extract 20 runes in the row, all in 1 game tick for each rune.",
	ng3ps18 : "Be in 20 unique challenges at the same time."
};
const allAchievementNums = Object.invert(allAchievements)
// to retrieve by value: Object.keys(allAchievements).find(key => allAchievements[key] === "L4D: Left 4 Dimensions");

function clearOldAchieves(){
    var toRemove = [];
    var achieveKey;
    var values = Object.keys(allAchievements).map(function(e) { return allAchievements[e] });
    for (var i = 0; i < player.achievements.length; i++) {
      if (values.indexOf(player.achievements[i]) !== -1 ) {  // does index[i] exist in allAchievements as a value?
        toRemove.push(i); // mark it for removal
        achieveKey = Object.keys(allAchievements).find(function(key){ return allAchievements[key] === player.achievements[i];});
        if (!player.achievements.includes(achieveKey)) { // check if new key already exists as well
            player.achievements.push(achieveKey); // if not... add it
        }
      } else if (allAchievements[player.achievements[i]] === undefined){
        var r=player.achievements[i].indexOf("r")
        if (r<0) r=0
        else r=parseInt(player.achievements[i].split("r")[1])
        if (r<140) toRemove.push(i)
      }
    }


    toRemove.reverse();
    for (var i = 0; i < toRemove.length; i++) {
      player.achievements.splice(toRemove[i], 1);
    }
}

function giveAchievement(name, noUpdate) {
	if (player.achievements.includes(name)){ clearOldAchieves(); }

	if (player.achievements.includes(allAchievementNums[name])) return false

	var ngudAchId=allAchievementNums[name].split("ngud")[1]
	if (ngudAchId!=undefined) if (player.exdilation==undefined) return

	var ngppAchId=allAchievementNums[name].split("ngpp")[1]
	if (ngppAchId!=undefined) {
		ngppAchId=parseInt(ngppAchId)
		if (player.meta==undefined&&(player.exdilation==undefined||(ngppAchId!=13&&ngppAchId!=18))) return
	}

	if (allAchievementNums[name].split("ng3p")[1]&&!player.masterystudies) return false

	if (player.boughtDims) {
		var r=allAchievementNums[name].split("r")[1]
		if (r<0) r=0
		else r=parseInt(allAchievementNums[name].split("r")[1])
		if (r==105||(r!=117&&r>110)) return false
	}

	player.achievements.push(allAchievementNums[name])
	if (name == "All your IP are belong to us" || name == "MAXIMUM OVERDRIVE") {
		player.infMult = player.infMult.times(4);
		player.autoIP = player.autoIP.times(4);
		if (player.autoCrunchMode == "amount" && player.autobuyers[11].priority != undefined) player.autobuyers[11].priority = Decimal.times(player.autobuyers[11].priority, 4);
	}
	if (name == "The swarm" && player.boughtDims) document.getElementById('replicantigalaxypowerdiv').style.display=""
	if (name == "I told you already, time is relative" || name == "I'm so meta" || name == "To the new dimension!") updateHotkeys()
	if (name == "GAS GAS GAS") {
		for (i=1;i<9;i++) document.getElementById("td"+i+'auto').style.visibility="visible"
		document.getElementById('togglealltimedims').style.display=""
		document.getElementById('epmultauto').style.display=""
		if (player.aarexModifications.ngudpV) document.getElementById("blackholeAuto").style.display=""
	}
	if (name == "It will never be enough") document.getElementById('replicantibulkmodetoggle').style.display="inline-block"
	if (name == "I already got rid of you..." || name == "No dilation means no production.") {
		player.dilation.bestTP = Decimal.max(player.dilation.tachyonParticles, player.dilation.bestTP)
		document.getElementById('bestTP').style.display=""
		document.getElementById('bestTP').textContent="Your best ever Tachyon particles was "+shorten(player.dilation.bestTP)+"."
	}
	if (name == "Twice in the row") document.getElementById('toggleautoquantummode').style.display=""
	if (name == "Stop blocking me!") document.getElementById('autoReset').style.display=""
	if (name == "Quantum doesn't take so long") {
		updateAutobuyers()
		updateAutoEterMode()
		loadAutoBuyerSettings()
	}
	if (name == "Kee-hee-hee!" && (player.achievements.includes("ng3p18") || player.achievements.includes("ng3p37"))) setAndMaybeShow('bestTPOverGhostifies',true,'"Your best-ever Tachyon particles was "+shorten(player.dilation.bestTPOverGhostifies)+"."')
    if (!noUpdate) {
		if (name == "A sound financial decision") localStorage.setItem(btoa("dsAM_asfd"),"")
		else $.notify(name, "success");
		updateAchievements()
	}
}

function updateAchievements() {
	var amount = 0
	var rowsShown = 0
	var rowsNum = 0
	for (var i=1; i<24; i++) {
		var shown=true
		var rowid=i
		if (i>15) {
			shown=!(!player.masterystudies)
			rowid="ng3p"+(i-15)
		} else if (i>14) {
			shown=player.meta!=undefined
			rowid="ngpp1"
		} else if (i>13) {
			shown=player.exdilation!=undefined
			rowid="ngud1"
		} else if (i>10) shown=!player.boughtDims
		rowid="achRow" + rowid
		var n = 0
		if (shown) {
			rowsNum++
			var achNum = i * 10
			for (var l=0; l<8; l++) {
				achNum += 1;
				var realAchNum=achNum
				if (player.boughtDims) {
					if (realAchNum==35) realAchNum=22
					else if (realAchNum==76) realAchNum=35
					else if (realAchNum==22) realAchNum=41
					else if (realAchNum==41) realAchNum=76
				}
				var achId="r"+achNum
				if (achNum>160) achId="ng3p"+(achNum-150)
				else if (achNum>150) achId="ngpp"+(achNum-140)
				else if (achNum==145) achId="ngpp13"
				else if (achNum==147) achId="ngpp18"
				else if (achNum>140) achId="ngud"+(achNum-130)
				var name=allAchievements[achId]
				if (player.achievements.includes(achId)) {
					n++
					document.getElementById(name).className = "achievementunlocked"
				} else {
					document.getElementById(name).className = "achievementlocked"
				}
			}
			if (n == 8) {
				document.getElementById(rowid).className = "completedrow"
				if (player.aarexModifications.hideCompletedAchs) shown = false
				amount++
			} else document.getElementById(rowid).className = ""
		}
		document.getElementById(rowid).style.display = shown ? "" : "none"
		if (shown) {
			rowsShown++
			var numberelement = document.getElementById(rowid + "number")
			if (numberelement === null) {
				document.getElementById(rowid).insertCell(0).innerHTML = '<div class="achRowInfo" id="' + rowid + 'number"></div>'
				numberelement = document.getElementById(rowid + "number")
			}
			numberelement.parentElement.style.display = player.aarexModifications.showAchRowNums ? "" : "none"
			if (player.aarexModifications.showAchRowNums) numberelement.innerHTML = "Row #" + rowsNum + "<br>" + n + " / 8<br>(" + (n*12.5).toFixed(1) + "%)"
		}
	}
	player.achPow = Decimal.pow(player.aarexModifications.newGameMinusMinusVersion ? 5 : 1.5, amount)
	document.getElementById("achmultlabel").textContent = "Current achievement multiplier on each Dimension: " + shortenMoney(player.achPow) + "x"
	document.getElementById("nothingness").style.display = rowsShown ? "none" : ""

	rowsShown = 0
	rowsNum = 0
	for (var i=1; i<document.getElementById("secretachievementtable").children[0].children.length+1; i++) {
		var shown=true
		var rowid="secretAchRow"+i
		if (i>3) {
			shown=player.masterystudies!==undefined
			rowid="secretAchRowng3p"+(i-3)
		}
		var n = 0
		if (shown) {
			rowsNum++
			var achNum = i * 10
			for (var l=0; l<8; l++) {
				achNum += 1;
				var achId = "s"+achNum
				if (achNum>40) achId = "ng3ps"+(achNum-30)
				var name = allAchievements[achId]
				if (player.achievements.includes(achId)) {
					n++
					document.getElementById(name).setAttribute('ach-tooltip', secretAchievementTooltips[achId])
					document.getElementById(name).className = "achievementunlocked"
				} else {
					document.getElementById(name).className = "achievementhidden"
					document.getElementById(name).setAttribute('ach-tooltip', (name[name.length-1] !== "?" && name[name.length-1] !== "!" && name[name.length-1] !== ".") ? name+"." : name)
				}
			}
			if (n == 8) {
				document.getElementById(rowid).className = "completedrow"
				if (player.aarexModifications.hideCompletedAchs) shown = false
				amount++
			} else document.getElementById(rowid).className = ""
		}
		document.getElementById(rowid).style.display = shown ? "" : "none"
		if (shown) {
			rowsShown++
			var numberelement = document.getElementById(rowid + "number")
			if (numberelement === null) {
				document.getElementById(rowid).insertCell(0).innerHTML = '<div class="achRowInfo" id="' + rowid + 'number"></div>'
				numberelement = document.getElementById(rowid + "number")
			}
			numberelement.parentElement.style.display = player.aarexModifications.showAchRowNums ? "" : "none"
			if (player.aarexModifications.showAchRowNums) numberelement.innerHTML = "Secret row #" + rowsNum + "<br>" + n + " / 8<br>(" + (n*12.5).toFixed(1) + "%)"
		}
	}
	document.getElementById("nothingnessSecret").style.display = rowsShown ? "none" : ""
}

function getSecretAchAmount() {
    var n = 0
    for (var i=1; i<document.getElementById("secretachievementtable").children[0].children.length+1; i++) {
        var achNum = i * 10
        for (var l=0; l<8; l++) {
            achNum += 1;
            if (player.achievements.includes("s"+achNum)) {
                n++
            }
        }
    }
    return n
}

function toggleAchRowNums() {
	// 0 == not visible, 1 == visible
	player.aarexModifications.showAchRowNums=!player.aarexModifications.showAchRowNums
	updateAchievements()
	document.getElementById("showAchRowNums").textContent=(player.aarexModifications.showAchRowNums?"Hide":"Show")+" achievement row info"
}

function toggleCompletedAchs() {
	// 0 == visible, 1 == not visible
	player.aarexModifications.hideCompletedAchs=!player.aarexModifications.hideCompletedAchs
	updateAchievements()
	document.getElementById("hideCompletedAchs").textContent=(player.aarexModifications.hideCompletedAchs?"Show":"Hide")+" completed achievement rows"
}

function toggleSecretAchs() {
	// 0 == visible, 1 == not visible
	player.aarexModifications.hideSecretAchs=!player.aarexModifications.hideSecretAchs
	if (document.getElementById("secretachievements").style.display == "block") showAchTab("normalachievements")
	document.getElementById("hideSecretAchs").textContent=(player.aarexModifications.hideSecretAchs?"Show":"Hide")+" secret achievements"
}